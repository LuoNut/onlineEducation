(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-community-reply-reply"],{"0442":function(e,t,n){"use strict";n.r(t);var i=n("dfd0"),r=n("e54d");for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("5890");var a=n("f0c5"),c=Object(a["a"])(r["default"],i["b"],i["c"],!1,null,"16025f76",null,!1,i["a"],void 0);t["default"]=c.exports},"04e2":function(e,t,n){var i=n("d810");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var r=n("4f06").default;r("63ce590d",i,!0,{sourceMap:!1,shadowMode:!1})},"0bc7":function(e,t,n){"use strict";var i=n("ff23"),r=n.n(i);r.a},"268d":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.commentFrame[data-v-d85199aa]{position:fixed;left:0;bottom:0;box-sizing:border-box;width:100%;padding:%?20?% %?30?%;background-color:#fff;z-index:100}',""]),e.exports=t},"325c":function(e,t,n){"use strict";(function(e){n("7a82");var i=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.courseLikeFun=function(e){return l.apply(this,arguments)},t.getImgSrc=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=[];return e.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/g,(function(e,t){n.push(t)})),n=n.slice(0,t),n},t.getProvince=function(){return new Promise((function(e,t){var n=uni.getStorageSync("historyProvince");n?Date.now()-n.time>36e5?u().then((function(t){e(t)})).catch((function(e){t(e)})):e(n.province):u().then((function(t){e(t)})).catch((function(e){t(e)}))}))},t.giveAvatar=function(e){var t,n,i;return null!==(t=null===(n=e.user_id[0])||void 0===n||null===(i=n.avatar_file)||void 0===i?void 0:i.url)&&void 0!==t?t:"/static/images/user-default.jpg"},t.giveName=function(e){var t;return e?null===(t=e.user_id[0])||void 0===t?void 0:t.nickname:""},t.likeFun=function(e){return s.apply(this,arguments)};var r=i(n("c7eb")),o=i(n("1da1"));n("ac1f"),n("5319"),n("14d9"),n("fb6a"),n("d3b7");n("606a");var a=e.database(),c=e.importObject("utils-obj",{customUI:!0});function u(){return new Promise((function(e,t){uni.request({url:"https://restapi.amap.com/v3/ip?key=1e4c4960ff4e574cd39128750c5834ed",success:function(t){var n="";console.log("111"),n="string"===typeof t.data.province?t.data.province:"火星",e(n);var i={province:n,time:Date.now()};uni.setStorageSync("historyProvince",i)},fail:function(e){t(e)}})}))}function s(){return s=(0,o.default)((0,r.default)().mark((function e(t){var n;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.collection("blog_like").where('article_id=="'.concat(t,'" && user_id==$cloudEnv_uid')).count();case 2:n=e.sent,console.log(n),n.result.total?(a.collection("blog_like").where('article_id=="'.concat(t,'" && user_id==$cloudEnv_uid')).remove(),c.operation("blog_article","like_count",t,-1)):a.collection("blog_like").add({article_id:t}).then((function(e){c.operation("blog_article","like_count",t,1)}));case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function l(){return l=(0,o.default)((0,r.default)().mark((function e(t){var n;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.collection("course_like").where('course_id=="'.concat(t,'" && user_id==$cloudEnv_uid')).count();case 2:n=e.sent,console.log(n),n.result.total?(a.collection("course_like").where('course_id=="'.concat(t,'" && user_id==$cloudEnv_uid')).remove(),c.operation("course_video","like_count",t,-1)):a.collection("course_like").add({course_id:t}).then((function(e){c.operation("course_video","like_count",t,1)}));case 5:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}}).call(this,n("a9ff")["default"])},5170:function(e,t,n){"use strict";(function(e){n("7a82");var i=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n("c7eb")),o=i(n("5530")),a=i(n("1da1")),c=n("606a"),u=i(n("db48")),s=n("325c"),l=e.database(),d=e.importObject("utils-obj",{customUI:!0}),f={name:"commentFrame",props:{schema:{type:String},commentObj:{type:Object,default:function(){return{}}},placeholder:{type:String,default:"评论点什么吧..."}},data:function(){return{replyContent:""}},methods:{goComment:function(){var e=this;return(0,a.default)((0,r.default)().mark((function t(){var n;return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(c.store.hasLogin){t.next=3;break}return uni.showModal({title:"登录才能进行评论哦，是否进行登录？",success:function(e){e.confirm&&uni.navigateTo({url:"/"+u.default.uniIdRouter.loginPage})}}),t.abrupt("return");case 3:if(e.replyContent){t.next=6;break}return uni.showToast({title:"评论不能为空！",icon:"none"}),t.abrupt("return");case 6:return t.next=8,(0,s.getProvince)();case 8:n=t.sent,l.collection("".concat(e.schema,"_comment")).add((0,o.default)({comment_content:e.replyContent,province:n},e.commentObj)).then((function(t){uni.showToast({title:"评论成功",icon:"none"}),e.$emit("commentEvn",{comment_content:e.replyContent,province:n}),e.replyContent="",d.operation("".concat(e.schema,"_article"),"comment_count",e.commentObj.course_id,1)}));case 10:case"end":return t.stop()}}),t)})))()}}};t.default=f}).call(this,n("a9ff")["default"])},5890:function(e,t,n){"use strict";var i=n("04e2"),r=n.n(i);r.a},6726:function(e,t,n){"use strict";var i=n("9305"),r=n.n(i);r.a},"6dac":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"commentItem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.toReply.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"avatar"},[n("v-uni-image",{attrs:{src:e.giveAvatar(e.item),mode:"aspectFill"}})],1),n("v-uni-view",{staticClass:"wrap"},[n("v-uni-view",{staticClass:"name"},[e._v(e._s(e.giveName(e.item))),n("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:!e.showClose,expression:"!showClose"}],staticClass:"iconfont icon-close",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.onDelete()}}})],1),n("v-uni-view",{staticClass:"text"},[e._v(e._s(e.item.comment_content))]),n("v-uni-view",{staticClass:"info"},[n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:!e.showReply,expression:"!showReply"}],staticClass:"replyBtn"},[e._v(e._s(e.item.totalReply?e.item.totalReply:"")+"回复")]),n("v-uni-view",{staticClass:"time"},[n("v-uni-text",[e._v(e._s(e.formatDate(e.item.comment_date)))])],1),n("v-uni-view",{staticClass:"address"},[e._v(e._s(e.item.province))])],1)],1)],1)],1)},r=[]},"6dc4":function(e,t,n){"use strict";n.r(t);var i=n("e9a8"),r=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=r.a},"72d8":function(e,t,n){"use strict";(function(e){n("7a82");var i=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n("c7eb")),o=i(n("1da1")),a=i(n("5530"));n("c740"),n("a434"),n("3c65"),n("99af");var c=n("325c"),u=n("606a"),s=e.database(),l={data:function(){return{replyItem:null,commentObj:{article_id:"",comment_type:1,reply_user_id:"",reply_comment_id:""},replyList:[],noComment:!1}},onLoad:function(){var e=uni.getStorageSync("replyItem")||{};e?(this.replyItem=e,this.commentObj.article_id=e.article_id,this.commentObj.reply_user_id=e.user_id[0]._id,this.commentObj.reply_comment_id=e._id,this.getArticleComment()):uni.navigateBack()},methods:{giveName:c.giveName,P_removeEvn:function(e){var t=this.replyList.findIndex((function(t){return e==t._id}));this.replyList.splice(t,1)},P_commentEvn:function(e){this.replyList.unshift((0,a.default)((0,a.default)({},e),{},{user_id:[u.store.userInfo],comment_date:Date.now()}))},getArticleComment:function(){var e=this;return(0,o.default)((0,r.default)().mark((function t(){var n,i,o;return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=s.collection("blog_comment").where('article_id == "'.concat(e.replyItem.article_id,'" && comment_type==1 && reply_comment_id=="').concat(e.replyItem._id,'"')).getTemp(),i=s.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),t.next=4,s.collection(n,i).orderBy("comment_date desc").get();case 4:if(o=t.sent,o.result.data.length){t.next=7;break}return t.abrupt("return",e.noComment=!0);case 7:e.replyList=o.result.data;case 8:case"end":return t.stop()}}),t)})))()}}};t.default=l}).call(this,n("a9ff")["default"])},9305:function(e,t,n){var i=n("268d");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var r=n("4f06").default;r("6d27a944",i,!0,{sourceMap:!1,shadowMode:!1})},"97c0":function(e,t,n){"use strict";n.r(t);var i=n("6dac"),r=n("6dc4");for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("0bc7");var a=n("f0c5"),c=Object(a["a"])(r["default"],i["b"],i["c"],!1,null,"7d318dc3",null,!1,i["a"],void 0);t["default"]=c.exports},b3f4:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.commentItem[data-v-7d318dc3]{display:flex}.commentItem .avatar[data-v-7d318dc3]{width:%?50?%;height:%?50?%;margin:%?16?% %?20?% %?20?% %?20?%}.commentItem .avatar uni-image[data-v-7d318dc3]{width:100%;height:100%;border-radius:50%}.commentItem .wrap[data-v-7d318dc3]{flex:1}.commentItem .wrap .name[data-v-7d318dc3]{font-size:%?23?%;color:#666;padding:%?10?% 0;display:flex;align-items:center;justify-content:space-between}.commentItem .wrap .name .iconfont[data-v-7d318dc3]{color:#999;padding:%?10?%}.commentItem .wrap .text[data-v-7d318dc3]{font-size:%?30?%;padding-bottom:%?15?%}.commentItem .wrap .info[data-v-7d318dc3]{display:flex;font-size:%?22?%;color:#666}.commentItem .wrap .info uni-view[data-v-7d318dc3]{margin-right:%?25?%;line-height:%?41?%}.commentItem .wrap .info .replyBtn[data-v-7d318dc3]{width:%?120?%;background-color:#e4e4e4;text-align:center;border-radius:%?50?%}.commentItem .wrap .info .time[data-v-7d318dc3]{font-size:%?20?%}',""]),e.exports=t},d810:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.reply .top[data-v-16025f76]{padding:%?30?%;border-bottom:%?15?% solid #eee}.reply .list[data-v-16025f76]{padding:%?30?% %?60?%;padding-bottom:%?120?%}.reply .list .row[data-v-16025f76]{padding-bottom:%?15?%}',""]),e.exports=t},dfd0:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={commentItem:n("97c0").default,uEmpty:n("c94f").default,commentFrame:n("e71e").default},r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"reply"},[n("cu-custom",{attrs:{bgColor:"bg-gradual-blue",isBack:!0}},[n("template",{attrs:{slot:"backText"},slot:"backText"},[e._v("返回")]),n("template",{attrs:{slot:"content"},slot:"content"},[e._v("技术栈")])],2),n("v-uni-view",{staticClass:"top"},[n("comment-item",{attrs:{item:e.replyItem,showReply:!0,showClose:!0}})],1),n("v-uni-view",{staticClass:"list"},e._l(e.replyList,(function(t){return n("v-uni-view",{staticClass:"row"},[n("comment-item",{attrs:{item:t,showReply:!0},on:{removeEvn:function(t){arguments[0]=t=e.$handleEvent(t),e.P_removeEvn.apply(void 0,arguments)}}})],1)})),1),e.noComment?n("v-uni-view",[n("u-empty",{attrs:{mode:"comment",icon:"http://cdn.uviewui.com/uview/empty/comment.png"}})],1):e._e(),n("v-uni-view",[n("comment-frame",{attrs:{commentObj:e.commentObj,placeholder:"回复："+e.giveName(e.replyItem)},on:{commentEvn:function(t){arguments[0]=t=e.$handleEvent(t),e.P_commentEvn.apply(void 0,arguments)}}})],1)],1)},o=[]},e54d:function(e,t,n){"use strict";n.r(t);var i=n("72d8"),r=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=r.a},e71e:function(e,t,n){"use strict";n.r(t);var i=n("f249"),r=n("fc53");for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("6726");var a=n("f0c5"),c=Object(a["a"])(r["default"],i["b"],i["c"],!1,null,"d85199aa",null,!1,i["a"],void 0);t["default"]=c.exports},e9a8:function(e,t,n){"use strict";(function(e){n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n("325c"),r=e.importObject("utils-obj",{customUI:!0}),o=e.database(),a={name:"commentItem",props:{toTarget:{default:function(){return{}}},schema:{type:String},item:{type:Object,default:function(){return{}}},showReply:{type:Boolean,default:!1},showClose:{type:Boolean,default:!1}},onLoad:function(){},data:function(){return{}},methods:{giveName:i.giveName,giveAvatar:i.giveAvatar,formatDate:function(e){var t=new Date;t.setTime(e);var n=t.getMonth()+1,i=t.getHours();i<10&&(i="0"+i);var r=t.getMinutes();r<10&&(r="0"+r);var o=t.getFullYear()+"-"+n+"-"+t.getDate();return o},toReply:function(){console.log(this.item),this.showReply||(console.log(this.toTarget),this.toTarget?(console.log(this.toTarget),this.toTarget(this.item)):(uni.setStorageSync("replyItem",this.item),uni.navigateTo({url:"/pages/community/reply/reply"})))},onDelete:function(){var t=this,n=e.getCurrentUserInfo().uid;console.log(this.item),n==this.item.user_id[0]._id||this.uniIDHasRole("admin")||this.uniIDHasRole("webmaster")?uni.showModal({title:"是否确认删除？",success:function(e){e.confirm&&o.collection("".concat(t.schema,"_comment")).where('_id == "'.concat(t.item._id,'"')).remove().then((function(e){t.$emit("removeEvn",t.item._id),uni.showToast({title:"删除成功！"}),r.operation("".concat(t.schema,"_article"),"comment_count",t.item.article_id,-1)}))}}):uni.showToast({title:"权限不够",icon:"error"})}}};t.default=a}).call(this,n("a9ff")["default"])},f249:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uniEasyinput:n("fcc1").default},r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"commentFrame"},[n("uni-easyinput",{attrs:{placeholder:e.placeholder,suffixIcon:"paperplane"},on:{iconClick:function(t){arguments[0]=t=e.$handleEvent(t),e.goComment.apply(void 0,arguments)},confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.goComment.apply(void 0,arguments)}},model:{value:e.replyContent,callback:function(t){e.replyContent=t},expression:"replyContent"}})],1)],1)},o=[]},fc53:function(e,t,n){"use strict";n.r(t);var i=n("5170"),r=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=r.a},ff23:function(e,t,n){var i=n("b3f4");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var r=n("4f06").default;r("3035a6c6",i,!0,{sourceMap:!1,shadowMode:!1})}}]);