(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-community-edit-edit"],{"325c":function(t,e,i){"use strict";(function(t){i("7a82");var n=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.courseLikeFun=function(t){return u.apply(this,arguments)},e.getImgSrc=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=[];return t.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/g,(function(t,e){i.push(e)})),i=i.slice(0,e),i},e.getProvince=function(){return new Promise((function(t,e){var i=uni.getStorageSync("historyProvince");i?Date.now()-i.time>36e5?r().then((function(e){t(e)})).catch((function(t){e(t)})):t(i.province):r().then((function(e){t(e)})).catch((function(t){e(t)}))}))},e.giveAvatar=function(t){var e,i,n;return null!==(e=null===(i=t.user_id[0])||void 0===i||null===(n=i.avatar_file)||void 0===n?void 0:n.url)&&void 0!==e?e:"/static/images/user-default.jpg"},e.giveName=function(t){var e;return t?null===(e=t.user_id[0])||void 0===e?void 0:e.nickname:""},e.likeFun=function(t){return l.apply(this,arguments)};var o=n(i("c7eb")),a=n(i("1da1"));i("ac1f"),i("5319"),i("14d9"),i("fb6a"),i("d3b7");i("606a");var c=t.database(),s=t.importObject("utils-obj",{customUI:!0});function r(){return new Promise((function(t,e){uni.request({url:"https://restapi.amap.com/v3/ip?key=1e4c4960ff4e574cd39128750c5834ed",success:function(e){var i="";console.log("111"),i="string"===typeof e.data.province?e.data.province:"火星",t(i);var n={province:i,time:Date.now()};uni.setStorageSync("historyProvince",n)},fail:function(t){e(t)}})}))}function l(){return l=(0,a.default)((0,o.default)().mark((function t(e){var i;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c.collection("blog_like").where('article_id=="'.concat(e,'" && user_id==$cloudEnv_uid')).count();case 2:i=t.sent,console.log(i),i.result.total?(c.collection("blog_like").where('article_id=="'.concat(e,'" && user_id==$cloudEnv_uid')).remove(),s.operation("blog_article","like_count",e,-1)):c.collection("blog_like").add({article_id:e}).then((function(t){s.operation("blog_article","like_count",e,1)}));case 5:case"end":return t.stop()}}),t)}))),l.apply(this,arguments)}function u(){return u=(0,a.default)((0,o.default)().mark((function t(e){var i;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c.collection("course_like").where('course_id=="'.concat(e,'" && user_id==$cloudEnv_uid')).count();case 2:i=t.sent,console.log(i),i.result.total?(c.collection("course_like").where('course_id=="'.concat(e,'" && user_id==$cloudEnv_uid')).remove(),s.operation("course_video","like_count",e,-1)):c.collection("course_like").add({course_id:e}).then((function(t){s.operation("course_video","like_count",e,1)}));case 5:case"end":return t.stop()}}),t)}))),u.apply(this,arguments)}}).call(this,i("a9ff")["default"])},"342b":function(t,e,i){"use strict";var n=i("a693"),o=i.n(n);o.a},6114:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var n={uButton:i("78d4").default},o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"edit"},[i("cu-custom",{attrs:{bgColor:"bg-gradual-blue",isBack:!0}},[i("template",{attrs:{slot:"backText"},slot:"backText"},[t._v("返回")]),i("template",{attrs:{slot:"content"},slot:"content"},[t._v("发布长文")])],2),i("v-uni-view",{staticClass:"container"},[i("v-uni-view",{staticClass:"title"},[i("v-uni-input",{attrs:{type:"text",placeholder:"请输入完整的标题","placeholder-class":"placeholderClass"},model:{value:t.artobj.title,callback:function(e){t.$set(t.artobj,"title",e)},expression:"artobj.title"}})],1),i("v-uni-view",{staticClass:"content"},[i("v-uni-editor",{staticClass:"myEdit",attrs:{placeholder:"写点什么吧......","show-img-size":!0,"show-img-toolbar":!0,"show-img-resize":!0},on:{ready:function(e){arguments[0]=e=t.$handleEvent(e),t.onEditReady.apply(void 0,arguments)},focus:function(e){arguments[0]=e=t.$handleEvent(e),t.onfocus.apply(void 0,arguments)},statuschange:function(e){arguments[0]=e=t.$handleEvent(e),t.statuschange.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"btnGroup"},[i("u-button",{attrs:{type:"primary",text:"确认发表",disabled:!t.artobj.title.length},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onSubmit.apply(void 0,arguments)}}})],1),i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.showTool,expression:"showTool"}],staticClass:"tools"},[i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickHeader.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-zitibiaoti",class:t.showHeader?"active":""})],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickBold.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-zitijiacu",class:t.showBold?"active":""})],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickItalic.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-zitixieti",class:t.showItalic?"active":""})],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickDivider.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-fengexian"})],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clickInsertImage.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-charutupian"})],1),i("v-uni-view",{staticClass:"item",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.okEdit.apply(void 0,arguments)}}},[i("v-uni-text",{staticClass:"iconfont icon-duigoux"})],1)],1)],1)],1)},a=[]},"678b":function(t,e,i){"use strict";(function(t){i("7a82");var n=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("c7eb")),a=n(i("1da1")),c=n(i("5530"));i("a4d3"),i("e01a"),i("fb6a"),i("ac1f"),i("d3b7"),i("159b");var s=i("325c"),r=t.database(),l={data:function(){return{showTool:!1,showHeader:!1,showBold:!1,showItalic:!1,artobj:{title:"",content:"",description:"",picurls:[],province:"",subject_type:""}}},onLoad:function(t){var e=this;this.artobj.subject_type=t.subject_type,(0,s.getProvince)().then((function(t){e.artobj.province=t}))},methods:{onSubmit:function(){var t=this;uni.showLoading({title:"发布中..."}),this.editorCtx.getContents({success:function(e){t.artobj.content=e.html,t.artobj.description=e.text.slice(0,80),t.artobj.picurls=(0,s.getImgSrc)(e.html),t.setData()}})},setData:function(){r.collection("blog_article").add((0,c.default)({},this.artobj)).then((function(t){uni.hideLoading(),uni.showToast({title:"发布成功"}),setTimeout((function(){uni.navigateBack({delta:1})}),800)}))},onfocus:function(){this.showTool=!0},onEditReady:function(){var t=this;uni.createSelectorQuery().in(this).select(".myEdit").fields({size:!0,context:!0},(function(e){t.editorCtx=e.context})).exec()},clickDivider:function(){this.editorCtx.insertDivider()},clickHeader:function(){this.showHeader=!this.showHeader,this.editorCtx.format("header",!!this.showHeader&&"H1")},clickBold:function(){this.showBold=!this.showBold,this.editorCtx.format("bold")},clickItalic:function(){this.showItalic=!this.showItalic,this.editorCtx.format("italic")},clickInsertImage:function(){var e=this;uni.chooseImage({success:function(i){uni.showLoading({title:"上传中...",mask:!0}),i.tempFiles.forEach(function(){var i=(0,a.default)((0,o.default)().mark((function i(n){var a;return(0,o.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.uploadFile({filePath:n.path,cloudPath:n.name});case 2:a=i.sent,e.editorCtx.insertImage({src:a.fileID}),uni.hideLoading();case 5:case"end":return i.stop()}}),i)})));return function(t){return i.apply(this,arguments)}}())}})},okEdit:function(){this.showTool=!1},checkStatus:function(t,e,i){e.hasOwnProperty(t)?this[i]=!0:this[i]=!1},statuschange:function(t){var e=t.detail;this.checkStatus("header",e,"showHeader"),this.checkStatus("bold",e,"showBold"),this.checkStatus("italic",e,"showItalic")}}};e.default=l}).call(this,i("a9ff")["default"])},a693:function(t,e,i){var n=i("f7d9");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=i("4f06").default;o("4b2375a2",n,!0,{sourceMap:!1,shadowMode:!1})},ce37:function(t,e,i){"use strict";i.r(e);var n=i("6114"),o=i("eeeb");for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("342b");var c=i("f0c5"),s=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"5584a030",null,!1,n["a"],void 0);e["default"]=s.exports},eeeb:function(t,e,i){"use strict";i.r(e);var n=i("678b"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},f7d9:function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */[data-v-5584a030] .ql-editor::before{font-style:none;color:#e0e0e0}.edit .container[data-v-5584a030]{padding:%?30?%}.edit .container .title uni-input[data-v-5584a030]{height:%?120?%;font-size:%?46?%;border-bottom:%?1?% solid #e4e4e4;margin-bottom:%?30?%;color:#000}.edit .container .title uni-input .placeholderClass[data-v-5584a030]{color:#e0e0e0}.edit .container .content .myEdit[data-v-5584a030]{height:calc(100vh - %?500?%);margin-bottom:%?30?%}.edit .container .tools[data-v-5584a030]{position:fixed;left:0;bottom:0;display:flex;justify-content:space-around;align-items:center;width:100%;height:%?80?%;background-color:#fff;border-top:%?1?% solid #f4f4f4}.edit .container .tools .iconfont[data-v-5584a030]{font-size:%?36?%;color:#333}.edit .container .tools .iconfont.active[data-v-5584a030]{color:#0199fe}',""]),t.exports=e}}]);