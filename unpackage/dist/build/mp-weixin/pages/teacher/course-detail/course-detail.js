(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/teacher/course-detail/course-detail"],{"0e04":function(e,o,t){},"1a9d":function(e,o,t){"use strict";(function(e,s){var c=t("4ea4");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n,u=c(t("2eee")),r=c(t("9523")),i=c(t("c973"));function a(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);o&&(s=s.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,s)}return t}function l(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?a(Object(t),!0).forEach((function(o){(0,r.default)(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var d=e.database(),f={data:function(){return{courseId:"",oldcourseData:{},courseData:{},courseTypeShow:!1,columns:[["计算机","理学，工学，农学","外语","心理学","音乐与艺术","文史哲学","医学与保健 ","教育教学"],["计算机基础","软件工程","网络与安全技术","硬件系统及应用","前端开发"]],columnData:[["计算机基础","软件工程","网络与安全技术","硬件系统及应用","前端开发"],["力学","机械","材料","电气信息","土木","工学","化学","数学"],["听力口语","语法阅读","写作翻译","四六级","雅思","其它语言"],["心理学"],["文学文化","新闻传播","哲学","历史","政治"],["设计，创作","艺术学","美术学","戏剧与影视","设计学","音乐与舞蹈"],["体育教育","基础医学","临床医学","公共卫生","口腔医学","中医药医学","药学","护理学","老年医学","儿医学","妇产科学","急诊与灾难医学"],["教学方法","教学能力","信息化教学","职业素养","学科教学","素质教育","体育教学","学前教育"]],cId:1,classList:[],oldClassList:[],Vid:1,currentIndex:0,courseTotalTime:[],totalTime:null,courseNum:null}},onLoad:function(e){console.log(e.courseId),this.courseId=e.courseId,this.getCourseData()},watch:{},methods:(n={getCourseData:function(){var e=this;return(0,i.default)(u.default.mark((function o(){var t,s;return u.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,d.collection("course_video").where('"'.concat(e.courseId,'" == _id')).field("course_name,subject_type_one,subject_type_two,course_intro,courseware,courseCover,course_video,course_time,course_video_num").get();case 2:return t=o.sent,e.courseData=t.result.data[0],e.oldcourseData=JSON.parse(JSON.stringify(t.result.data[0])),e.Vid=e.courseData.course_video.length,console.log(e.courseData.course_video),console.log(e.courseData),o.next=10,d.collection("teacher_course").where('"'.concat(e.courseId,'" == course && user_id == $cloudEnv_uid')).field("class").get();case 10:s=o.sent,console.log(s.result.data),s.result.data.forEach((function(o,t){console.log(o.class),e.classList.push({id:t,courseClass:o.class}),e.cId=e.classList.length,e.oldClassList=JSON.parse(JSON.stringify(e.classList))}));case 13:case"end":return o.stop()}}),o)})))()},selectionType:function(){this.courseTypeShow=!0},changeHandler:function(e){var o=e.columnIndex,t=(e.value,e.values,e.index),s=e.picker,c=void 0===s?this.$refs.uPicker:s;0===o&&c.setColumnValues(1,this.columnData[t])},confirm:function(e){console.log("confirm",e.value),this.courseData.subject_type_one=e.value[0],this.courseData.subject_type_two=e.value[1],this.courseTypeShow=!1},onCancel:function(){this.courseTypeShow=!1},addItem:function(){var e={id:parseInt(this.cId)+1,courseClass:""};this.classList.push(e),this.cId=parseInt(this.cId)+1,console.log(this.cId)},delItem:function(e){if(1==e.cId)return s.showToast({title:"不能删除第1个",icon:"none"}),!1;this.classList=this.classList.filter((function(o){return o!=e}))},addItemVideo:function(){var e={id:parseInt(this.Vid)+1,section:"",videoSrc:[]};this.oldcourseData.course_video.push(e),this.courseData.course_video.push(JSON.parse(JSON.stringify(e))),this.Vid=parseInt(this.Vid)+1}},(0,r.default)(n,"delItem",(function(e){if(1==e.Vid)return s.showToast({title:"不能删除第1个",icon:"none"}),!1;this.courseData.course_video=this.courseData.course_video.filter((function(o){return o!=e}))})),(0,r.default)(n,"coursewareUpload",(function(){this.$refs.coursewareFiles.upload()})),(0,r.default)(n,"courseCoverUpload",(function(){this.$refs.courseCoverFiles.upload()})),(0,r.default)(n,"upload",(function(e){console.log(e),this.currentIndex=e,console.log(this.currentIndex),this.$refs.files[e].upload()})),(0,r.default)(n,"select",(function(e){console.log(e),this.courseTotalTime.push({cloudPath:e.tempFiles[0].file.cloudPath,duration:e.tempFiles[0].file.duration}),console.log(this.courseTotalTime),console.log(this.courseData)})),(0,r.default)(n,"deleteFile",(function(e){var o=this;console.log(e),this.courseTotalTime.forEach((function(t,s){t.cloudPath==e.tempFile.cloudPath&&o.courseTotalTime.splice(s,1)})),this.courseData.course_video.forEach((function(t,s){t.videoSrc.forEach((function(t,c){t.src==e.tempFile.src&&o.courseData.course_video[s].videoSrc.splice(s,1)}))})),this.courseData.course_video_num-=1,console.log(this.courseTotalTime)})),(0,r.default)(n,"progress",(function(e){console.log("上传进度：",e),console.log(this.courseData)})),(0,r.default)(n,"success",(function(e){var o=this;console.log(e);var t={};console.log(this.courseData),console.log(this.oldcourseData),e.tempFiles.forEach((function(e){t.name=e.name.substring(0,e.name.indexOf(".")),t.src=e.url,t.size=e.size,o.courseData.course_video[o.currentIndex].videoSrc.push(t),console.log(t),t={}})),this.courseData.course_video_num+=1})),(0,r.default)(n,"fail",(function(e){console.log("上传失败：",e)})),(0,r.default)(n,"upCoursewareSelect",(function(e){console.log("选择文件：",e)})),(0,r.default)(n,"upCoursewareSuccess",(function(e){var o=this;console.log(e);var t={};e.tempFiles.forEach((function(e){t.name=e.name.substring(0,e.name.indexOf(".")),t.src=e.url,t.size=e.size,o.courseData.courseware.push(t)}))})),(0,r.default)(n,"upCourseCoverSuccess",(function(e){console.log(e.tempFilePaths[0]),this.courseData.courseCover=e.tempFilePaths[0]})),(0,r.default)(n,"courseToTime",(function(){var e=this;this.courseNum=this.courseTotalTime.length,this.courseTotalTime.forEach((function(o){e.totalTime+=o.duration})),console.log(this.totalTime),this.courseData.course_time+=this.totalTime})),(0,r.default)(n,"uniformHeading",(function(){var e=this;this.oldcourseData.course_video.forEach((function(o,t){e.courseData.course_video[t].section=o.section}))})),(0,r.default)(n,"onAccomplish",(function(){this.uniformHeading(),this.courseToTime(),this.upCourseData(),console.log(this.courseData),console.log(this.oldcourseData),console.log(this.classList)})),(0,r.default)(n,"upCourseData",(function(){var e=this;return(0,i.default)(u.default.mark((function o(){var t;return u.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return s.showLoading({title:"上传中...",mask:!0}),delete e.courseData._id,o.next=4,d.collection("course_video").where('"'.concat(e.courseId,'" == _id')).update(l({},e.courseData));case 4:t=o.sent,console.log(t),e.courseVideoId=t.result.id,e.upTeacherClass(),s.hideLoading(),s.showToast({title:"修改成功"}),s.reLaunch({url:"/pages/tabbar/teacher/teacher"});case 11:case"end":return o.stop()}}),o)})))()})),(0,r.default)(n,"upTeacherClass",(function(){var e=this;console.log(this.classList),console.log(this.oldClassList),this.classList.length==this.oldClassList.length?this.classList.forEach((function(o,t){e.oldClassList[t].class!=o.class&&e.upTeacherClassFun()})):(console.log("1"),this.upTeacherClassFun())})),(0,r.default)(n,"upTeacherClassFun",(function(){var e=this;return(0,i.default)(u.default.mark((function o(){var t;return u.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log(e.classList),console.log(e.courseId),o.next=4,d.collection("teacher_course").where('"'.concat(e.courseId,'" == course')).remove();case 4:t=o.sent,console.log(t),e.classList.forEach((function(o,t){console.log(1,o.courseClass),d.collection("teacher_course").add({course:e.courseId,class:o.courseClass}).then((function(e){console.log(e)}))}));case 7:case"end":return o.stop()}}),o)})))()})),(0,r.default)(n,"ondelectCourse",(function(){var e=this;s.showModal({title:"是否确定删除?",success:function(o){console.log(o),o.confirm&&d.collection("course_video").where('"'.concat(e.courseId,'" == _id')).remove().then((function(e){console.log(e),console.log("111"),s.showToast({title:"删除成功!"}),setTimeout((function(){s.reLaunch({url:"/pages/tabbar/teacher/teacher"})}),700)}))}})})),n)};o.default=f}).call(this,t("a9ff")["default"],t("543d")["default"])},2179:function(e,o,t){"use strict";t.d(o,"b",(function(){return c})),t.d(o,"c",(function(){return n})),t.d(o,"a",(function(){return s}));var s={uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"163c"))},uPicker:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-picker/u-picker")]).then(t.bind(null,"02fc"))},"u-Textarea":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(t.bind(null,"6251"))},uniFilePicker:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(t.bind(null,"dd7b"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"78d4"))},"u-Input":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--input/u--input")]).then(t.bind(null,"5bad"))}},c=function(){var e=this.$createElement;this._self._c},n=[]},4062:function(e,o,t){"use strict";t.r(o);var s=t("2179"),c=t("f0fa");for(var n in c)["default"].indexOf(n)<0&&function(e){t.d(o,e,(function(){return c[e]}))}(n);t("ded3");var u=t("f0c5"),r=Object(u["a"])(c["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);o["default"]=r.exports},ded3:function(e,o,t){"use strict";var s=t("0e04"),c=t.n(s);c.a},e94e:function(e,o,t){"use strict";(function(e,o){var s=t("4ea4");t("dac0"),t("a9ff");s(t("66fd"));var c=s(t("4062"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(c.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},f0fa:function(e,o,t){"use strict";t.r(o);var s=t("1a9d"),c=t.n(s);for(var n in s)["default"].indexOf(n)<0&&function(e){t.d(o,e,(function(){return s[e]}))}(n);o["default"]=c.a}},[["e94e","common/runtime","common/vendor"]]]);