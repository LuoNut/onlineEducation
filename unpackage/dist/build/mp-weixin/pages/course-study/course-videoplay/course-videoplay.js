(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/course-study/course-videoplay/course-videoplay"],{"1f08":function(e,t,n){"use strict";n.r(t);var o=n("49ac"),i=n("6649");for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);n("21c4");var s=n("f0c5"),r=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"2e5cf646",null,!1,o["a"],void 0);t["default"]=r.exports},"21c4":function(e,t,n){"use strict";var o=n("5bd5"),i=n.n(o);i.a},"49ac":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return o}));var o={uTabs:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-tabs/u-tabs")]).then(n.bind(null,"91d9"))},uniFav:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-fav/components/uni-fav/uni-fav")]).then(n.bind(null,"399a"))},uniCollapse:function(){return n.e("uni_modules/uni-collapse/components/uni-collapse/uni-collapse").then(n.bind(null,"c0b5"))},uniCollapseItem:function(){return n.e("uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item").then(n.bind(null,"cbf4"))},uEmpty:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-empty/u-empty")]).then(n.bind(null,"c94f"))},commentItem:function(){return n.e("components/comment-item/comment-item").then(n.bind(null,"97c0"))},commentFrame:function(){return n.e("components/comment-frame/comment-frame").then(n.bind(null,"e71e"))},uPopup:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(n.bind(null,"83a3"))}},i=function(){var e=this.$createElement,t=(this._self._c,this.giveName(this.replyItem));this.$mp.data=Object.assign({},{$root:{m0:t}})},c=[]},"5bd5":function(e,t,n){},6649:function(e,t,n){"use strict";n.r(t);var o=n("6c922"),i=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},"6c922":function(e,t,n){"use strict";(function(e,o){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=i(n("2eee")),s=i(n("9523")),r=i(n("c973")),u=n("325c"),a=n("606a"),l=i(n("db48"));n("b600");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=e.database(),f={data:function(){return{courseId:null,courseData:{},tabData:[{name:"简介"},{name:"课程"},{name:"课件"},{name:"在线笔记"},{name:"评论"}],tabIndex:0,noComment:!1,commentObj:{course_id:"",comment_type:0},commentList:[],courseUrl:"",courseTitle:"",checked:!1,lastPlayTime:null,playschedule:null,isSchedule:!0,play_total_time:null,playedList:[],initialTime:"",showTool:!1,showHeader:!1,showBold:!1,showItalic:!1,content:"",isOnlineNote:!1,secondComShow:!1,replyItem:null,secondCommentObj:{course_id:"",comment_type:1,reply_user_id:"",reply_comment_id:""},replyList:[],secondNoComment:!1}},onLoad:function(e){this.courseId=e.id,this.commentObj.course_id=e.id,this.scheduleFun(),this.getCourseData(),this.getCourseComment(),this.isOnlineNoteFun(),this.initialTime=Date.now()},onUnload:function(){this.playScheduleFun(),console.log(Date.now())},methods:{giveName:u.giveName,changeTab:function(e){this.tabIndex=e.index},onChangeTab:function(e){this.tabIndex=e.detail.current},videoEnd:function(e){var t,n=this;null===(t=this.playedList)||void 0===t||t.forEach((function(e){n.courseUrl})),this.playedList.push({courseUrl:this.courseUrl})},timeUpdata:function(e){this.playschedule=e.detail.currentTime},scheduleFun:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o,i,s,r;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,h.collection("course_play_history").where('"'.concat(e.courseId,'" == course_id && $cloudEnv_uid == user_id')).get();case 2:r=t.sent,r.result.affectedDocs?e.isSchedule=!0:e.isSchedule=!1,console.log(r.result.data[0]),e.courseUrl=null===(n=r.result.data[0])||void 0===n?void 0:n.course_src,e.lastPlayTime=null===(o=r.result.data[0])||void 0===o?void 0:o.play_time,e.play_total_time=null===(i=r.result.data[0])||void 0===i?void 0:i.play_total_time,e.playAcc=null===(s=r.result.data[0])||void 0===s?void 0:s.have_watched,e.getCourseData();case 10:case"end":return t.stop()}}),t)})))()},playScheduleFun:function(){var e=this;return(0,r.default)(c.default.mark((function t(){return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log(e.playedList),!e.isSchedule){t.next=7;break}return t.next=4,h.collection("course_play_history").where('"'.concat(e.courseId,'" == course_id && $cloudEnv_uid == user_id')).update({play_time:e.playschedule,course_id:e.courseId,course_src:e.courseUrl,play_date:Date.now(),play_total_time:e.play_total_time+Date.now()-e.initialTime,have_watched:e.playedList});case 4:t.sent,t.next=10;break;case 7:return t.next=9,h.collection("course_play_history").add({play_time:e.playschedule,course_id:e.courseId,course_src:e.courseUrl,play_date:Date.now(),play_total_time:Date.now()-e.initialTime,have_watched:e.playedList});case 9:t.sent;case 10:case"end":return t.stop()}}),t)})))()},getCourseData:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o,i,s,r,u;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=h.collection("course_video").where('_id=="'.concat(e.courseId,'"')).getTemp(),o=h.collection("uni-id-users").field("_id,username,name").getTemp(),i=h.collection("course_like").where('course_id=="'.concat(e.courseId,'" && user_id==$cloudEnv_uid')).getTemp(),s=[n,o],a.store.hasLogin&&s.push(i),t.next=7,h.collection.apply(h,s).get();case 7:r=t.sent,u=!1,a.store.hasLogin&&(u=!!r.result.data[0]._id.course_like.length),r.result.data[0].isLike=u,e.courseData=r.result.data[0],e.courseUrl=r.result.data[0].course_video[0].videoSrc[0].src,e.courseTitle=r.result.data[0].course_video[0].videoSrc[0].name;case 14:case"end":return t.stop()}}),t)})))()},onCollect:function(){if(a.store.hasLogin){var e=Date.now();e-this.likeTime<2e3?o.showToast({title:"点击太频繁了...",icon:"none"}):(this.courseData.isLike?this.courseData.like_count--:this.courseData.like_count++,this.courseData.isLike=!this.courseData.isLike,this.likeTime=e,(0,u.courseLikeFun)(this.courseId))}else o.showModal({title:"登录才能进行点赞哦，是否进行登录？",success:function(e){e.confirm&&o.navigateTo({url:"/"+l.default.uniIdRouter.loginPage})}})},videoPlay:function(e){this.lastPlayTime=null,this.courseUrl=e.src,this.courseTitle=e.name},openDocument:function(e){o.downloadFile({url:e,success:function(e){var t=e.tempFilePath;o.openDocument({filePath:t,success:function(e){console.log("打开文档成功")}})}})},isOnlineNoteFun:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,h.collection("online_note").where('"'.concat(e.courseId,'" == courseId && user_id==$cloudEnv_uid')).get();case 2:n=t.sent,n.result.affectedDocs?e.isOnlineNote=!0:e.isOnlineNote=!1,console.log(e.isOnlineNote),console.log(e.editorCtx),e.isOnlineNote&&(e.content=n.result.data[0].content,setTimeout((function(){e.editorCtx.setContents({html:n.result.data[0].content,success:function(t){e.content=t.html,console.log(n.result.data[0].content)}})}),1e3));case 7:case"end":return t.stop()}}),t)})))()},onfocus:function(){this.showTool=!0},onEditReady:function(){var e=this;o.createSelectorQuery().in(this).select(".myEdit").fields({size:!0,context:!0},(function(t){e.editorCtx=t.context})).exec()},clickDivider:function(){this.editorCtx.insertDivider()},clickHeader:function(){this.showHeader=!this.showHeader,this.editorCtx.format("header",!!this.showHeader&&"H1")},clickBold:function(){this.showBold=!this.showBold,this.editorCtx.format("bold")},clickItalic:function(){this.showItalic=!this.showItalic,this.editorCtx.format("italic")},clickInsertImage:function(){var t=this;o.chooseImage({success:function(n){o.showLoading({title:"上传中...",mask:!0}),n.tempFiles.forEach(function(){var n=(0,r.default)(c.default.mark((function n(i){var s;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.uploadFile({filePath:i.path,cloudPath:i.name});case 2:s=n.sent,t.editorCtx.insertImage({src:s.fileID}),o.hideLoading();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}})},okEdit:function(){this.showTool=!1,this.uploadNote(),o.showLoading({title:"保存中..."})},uploadNote:function(){var e=this;this.editorCtx.getContents({success:function(t){e.content=t.html,e.setData()}})},setData:function(){var e=this;console.log(this.isOnlineNote),this.isOnlineNote?h.collection("online_note").update({content:this.content}).then((function(e){console.log(e),o.showLoading(),o.showToast({title:"保存成功",icon:"none"})})):h.collection("online_note").add({content:this.content,courseId:this.courseId,courseName:this.courseData.course_name}).then((function(t){console.log(t),e.isOnlineNote=!0,o.showLoading(),o.showToast({title:"保存成功",icon:"none"})}))},checkStatus:function(e,t,n){t.hasOwnProperty(e)?this[n]=!0:this[n]=!1},statuschange:function(e){var t=e.detail;this.checkStatus("header",t,"showHeader"),this.checkStatus("bold",t,"showBold"),this.checkStatus("italic",t,"showItalic")},getCourseComment:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o,i,s,r;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=h.collection("course_comment").where('course_id == "'.concat(e.courseId,'" && comment_type==0')).getTemp(),o=h.collection("uni-id-users").field("_id,username,nickname").getTemp(),t.next=4,h.collection(n,o).orderBy("comment_date desc").get();case 4:return i=t.sent,console.log(i),s=i.result.data.map((function(e){return e._id})),t.next=9,h.collection("course_comment").where({reply_comment_id:h.command.in(s)}).groupBy("reply_comment_id").groupField("count(*) as totalReply").get();case 9:r=t.sent,i.result.data.forEach((function(e){var t=r.result.data.findIndex((function(t){return e._id==t.reply_comment_id}));t>-1&&(e.totalReply=r.result.data[t].totalReply)})),i.result.data.length||(e.noComment=!0),e.commentList=i.result.data,console.log(e.commentList);case 14:case"end":return t.stop()}}),t)})))()},P_commentEvn:function(e){console.log(e),this.commentList.length||(this.noComment=!1),this.commentList.unshift(m(m(m({user_id:[a.store.userInfo]},e),this.commentObj),{},{comment_date:Date.now()}))},P_deteleEvn:function(e){var t=this.commentList.findIndex((function(t){return e==t._id}));this.commentList.splice(t,1)},errFun:function(e){o.showToast({title:"参数错误",icon:"none"}),setTimeout((function(){o.reLaunch({url:"/pages/index/index"})}),800)},switchComment:function(e){this.secondComShow=!0,console.log("111"),e&&(this.replyItem=e,this.secondCommentObj.course_id=e.course_id,this.secondCommentObj.reply_user_id=e.user_id[0]._id,this.secondCommentObj.reply_comment_id=e._id,this.getArticleComment())},close:function(){this.secondComShow=!1},second_P_removeEvn:function(e){var t=this.replyList.findIndex((function(t){return e==t._id}));this.replyList.splice(t,1)},second_P_commentEvn:function(e){this.replyList.unshift(m(m({},e),{},{user_id:[a.store.userInfo],comment_date:Date.now()}))},getArticleComment:function(){var e=this;return(0,r.default)(c.default.mark((function t(){var n,o,i;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=h.collection("course_comment").where('course_id == "'.concat(e.replyItem.course_id,'" && comment_type==1 && reply_comment_id=="').concat(e.replyItem._id,'"')).getTemp(),o=h.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),t.next=4,h.collection(n,o).orderBy("comment_date desc").get();case 4:if(i=t.sent,i.result.data.length){t.next=7;break}return t.abrupt("return",e.secondNoComment=!0);case 7:e.replyList=i.result.data;case 8:case"end":return t.stop()}}),t)})))()}}};t.default=f}).call(this,n("a9ff")["default"],n("543d")["default"])},a112:function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("dac0"),n("a9ff");o(n("66fd"));var i=o(n("1f08"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["a112","common/runtime","common/vendor"]]]);