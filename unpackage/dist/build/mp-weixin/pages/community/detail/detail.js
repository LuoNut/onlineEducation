(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/community/detail/detail"],{1253:function(t,e,n){"use strict";var i=n("47bf"),a=n.n(i);a.a},"21a9":function(t,e,n){"use strict";(function(t,i){var a=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(n("2eee")),r=a(n("c973")),c=a(n("9523")),u=n("325c"),l=n("606a"),s=a(n("db48"));n("66fd");function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){(0,c.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f=t.database(),p=t.importObject("utils-obj",{customUI:!0}),g={data:function(){return{artId:"",tagStyle:{p:"line-height:1.7em; font-size:32rpx; padding-bottom:10rpx",img:"margin:10rpx 0"},loadingState:!0,artData:{},userLikeArr:[],commentObj:{article_id:"",comment_type:0},commentList:[],noComment:!1}},onLoad:function(t){t.id?(this.artId=t.id,this.commentObj.article_id=t.id,this.getData(),this.readUpdata(),this.getUserLikeAvatar(),this.getArticleComment()):this.errFun()},methods:{giveName:u.giveName,giveAvatar:u.giveAvatar,P_deteleEvn:function(t){var e=this.commentList.findIndex((function(e){return t==e._id}));this.commentList.splice(e,1)},P_commentEvn:function(t){this.commentList.length||(this.noComment=!1),this.commentList.unshift(d(d(d({user_id:[l.store.userInfo]},t),this.commentObj),{},{comment_date:Date.now()}))},getArticleComment:function(){var t=this;return(0,r.default)(o.default.mark((function e(){var n,i,a,r,c;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=f.collection("blog_comment").where('article_id == "'.concat(t.artId,'" && comment_type==0')).getTemp(),i=f.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),e.next=4,f.collection(n,i).orderBy("comment_date desc").get();case 4:return a=e.sent,r=a.result.data.map((function(t){return t._id})),e.next=8,f.collection("blog_comment").where({reply_comment_id:f.command.in(r)}).groupBy("reply_comment_id").groupField("count(*) as totalReply").get();case 8:c=e.sent,a.result.data.forEach((function(t){var e=c.result.data.findIndex((function(e){return t._id==e.reply_comment_id}));e>-1&&(t.totalReply=c.result.data[e].totalReply)})),a.result.data.length||(t.noComment=!0),t.commentList=a.result.data;case 12:case"end":return e.stop()}}),e)})))()},getUserLikeAvatar:function(){var t=this,e=f.collection("blog_like").where('article_id=="'.concat(this.artId,'"')).getTemp(),n=f.collection("uni-id-users").field("_id,avatar_file").getTemp();f.collection(e,n).orderBy("comment_date desc").limit(5).get().then((function(e){t.userLikeArr=e.result.data.reverse()}))},readUpdata:function(){p.operation("blog_article","view_count",this.artId,2)},likeUpdata:function(){if(l.store.hasLogin){var t=Date.now();t-this.likeTime<2e3?i.showToast({title:"点击太频繁了...",icon:"none"}):(this.artData.isLike?this.artData.like_count--:this.artData.like_count++,this.artData.isLike=!this.artData.isLike,this.likeTime=t,(0,u.likeFun)(this.artId))}else i.showModal({title:"登录才能进行点赞哦，是否进行登录？",success:function(t){t.confirm&&i.navigateTo({url:"/"+s.default.uniIdRouter.loginPage})}})},errFun:function(t){i.showToast({title:"参数错误",icon:"none"})},getData:function(){var t=this,e=f.collection("blog_article").where('_id=="'.concat(this.artId,'"')).getTemp(),n=f.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),a=f.collection("blog_like").where('article_id=="'.concat(this.artId,'" && user_id==$cloudEnv_uid')).getTemp(),o=[e,n];l.store.hasLogin&&o.push(a),f.collection.apply(f,o).get({getOne:!0}).then((function(e){var n=!1;l.store.hasLogin&&(n=!!e.result.data._id.blog_like.length),e.result.data.isLike=n,t.artData=e.result.data,t.loadingState=!1,i.setNavigationBarTitle({title:e.result.data.title})})).catch((function(t){}))}}};e.default=g}).call(this,n("a9ff")["default"],n("543d")["default"])},"47bf":function(t,e,n){},"544b":function(t,e,n){"use strict";n.r(e);var i=n("21a9"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},"60fe":function(t,e,n){"use strict";n.r(e);var i=n("f4b9"),a=n("544b");for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("1253");var r=n("f0c5"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"3bf36d60",null,!1,i["a"],void 0);e["default"]=c.exports},cb1d:function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("dac0"),n("a9ff");i(n("66fd"));var a=i(n("60fe"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},f4b9:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={uSkeleton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-skeleton/u-skeleton")]).then(n.bind(null,"1c88"))},uniDateformat:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(n.bind(null,"3a85"))},uParse:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(n.bind(null,"29c1"))},uEmpty:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-empty/u-empty")]).then(n.bind(null,"c94f"))},commentItem:function(){return n.e("components/comment-item/comment-item").then(n.bind(null,"97c0"))},commentFrame:function(){return n.e("components/comment-frame/comment-frame").then(n.bind(null,"e71e"))}},a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.loadingState?null:t.giveAvatar(t.artData)),i=t.loadingState?null:t.giveName(t.artData),a=t.__map(t.userLikeArr,(function(e,n){var i=t.__get_orig(e),a=t.giveAvatar(e);return{$orig:i,m2:a}}));t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,l0:a}})},o=[]}},[["cb1d","common/runtime","common/vendor"]]]);